<!DOCTYPE html>

<html lang="bg">

<head>
    <title>Оценка на JavaScript</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <link href="css/main.css" rel="stylesheet" />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
    <div class="container clearfix">
        <header id="top" class="clearfix">
            <h1 class="center-text">Оценка на JavaScript Уеб Приложения</h1>

            <span id="average-reading-time">
                Време за четене ~10мин
            </span>
        </header>

        <div class="row">
            <aside class="table-of-contents col-lg-4 col-md-5 col-12">
                <p class="title">Съдържание</p>

                <ul class="list">
                    <li>
                        <a href="#cost-of-javascript">Цената на JavaScript</a>

                        <ul>
                            <li><a href="#document-context">Контекст на реферата</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#javascript-metrics">Метрики</a>

                        <ul>
                            <li><a href="#download-traffic">Теглене (трафик)</a></li>
                            <li><a href="#parse-eval">Четене и Компилиране на JavaScript код</a></li>
                            <li><a href="#runtime-performance">Изпълнение на JavaScript</a></li>
                            <li><a href="#cost-of-javascript-other">Други</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#prpl-pattern">PRPL шаблон</a>

                        <ul>
                            <li><a href="#push-preload">Push/Preload: Подготвяне на минимално необходимите ресурси</a>
                            </li>
                            <li>
                                <a href="#first-paint">Render: Рисуване на началната страница</a>

                                <ul>
                                    <li><a href="#async-vs-defer">Async vs Defer</a></li>
                                </ul>
                            </li>
                            <li><a href="#pre-cache">Pre-Cache: Теглене на останалите ресурси на заден план</a></li>
                            <li><a href="#lazy-load">Lazy Load: Теглене на ресурси когато потрябват</a></li>
                        </ul>
                    </li>
                    <li><a href="#optimizations">Намаляване размера на кода</a></li>
                    <li>
                        <a href="#javascript-engines">JavaScript Engines</a>

                        <ul>
                            <li><a href="#javascript-engine-work">Как работят JavaScript Engines</a></li>
                        </ul>
                    </li>
                    <li><a href="#tools-for-speed-test">Инструменти за оценка на JavaScript приложение</a></li>
                    <li>
                        <a href="#google-services">Google услуги</a>

                        <ul>
                            <li><a href="#google-analytics">Google Analytics</a></li>
                            <li><a href="#google-tag-manager">Google Tag Manager</a></li>

                        </ul>
                    </li>
                    <li><a href="#conclusion">Заключение</a></li>
                    <li><a href="#references">Използвана литература</a></li>
                    <li><a href="#author-data">За автора</a></li>
                </ul>
            </aside>

            <div class="main offset-md-1 col-lg-7 col-md-6 col-12">
                <article id="cost-of-javascript">
                    <section class="introduction">
                        <h2>Цената на JavaScript</h2>

                        <p>
                            Използването на <span class="emphasized">JavaScript</span> за създаване на уеб приложение
                            често крие предизвикателства
                            за производителността на клиентската машина. Някои от тях са чисто технически и очевидни
                            като например изпълнение на много дълга и тежка логика. Но има и такива, на които не
                            се обръща достатъчно внимание и резултират в бавно зареждане на уеб приложението и
                            недоволство сред клиентите.
                        </p>

                        <p>
                            В този реферат ще разгледаме:
                        </p>

                        <ul>
                            <li>
                                <span class="bold">
                                    От какво зависи скоростта на JavaScript приложението
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Как браузърът разчита и изпълнява JavaScript код
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Как да направим приложението си по-бързо (подходи и оптимизации)
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Как можем да направим оценяване на JavaScript приложение
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Как да разберем какви устройства използват клиентите най-много
                                </span>
                            </li>
                        </ul>
                    </section>

                    <section id="document-context" class="content">
                        <h3>Контекст на реферата</h3>

                        <p>
                            Когато се говори за скорост на JavaScript приложение е важно да се знае контекстът -
                            информацията в този реферат е базирана на среден клас устройства, освен ако не е уточнено
                            допълнително. Тези устройства може да са с ограничени интернет възможности, процесори
                            и графични карти с ниска производителност, с ниска <span class="emphasized">RAM</span> памет
                            и без <span class="emphasized">кеш-слоеве</span> - L1, L2, L3 и т.н.
                        </p>

                        <p>
                            Заслужава си да се отбележи, че дадено устройство може да има високи технически параметри,
                            но интернет мрежата, към която е свързано, да е с ниска скорост или обратното.
                        </p>
                    </section>
                </article>

                <article id="javascript-metrics">
                    <section class="introduction">
                        <h2>Метрики</h2>

                        <p>
                            Добре е да имаме добро разделение на различни метрики, по които да анализираме
                            скоростта на дадено JavaScript приложение. Нека дефинираме няколко:
                        </p>

                        <ul>
                            <li>
                                <span class="bold">
                                    Теглене (трафик)
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Четене и Компилиране на JavaScript код
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Изпълнение на JavaScript код
                                </span>
                            </li>
                        </ul>

                        <p class="info box">
                            по-малко код = (по-малко трафик) + (по-малко време за декомпресия) +
                            (по-малко четене и компилиране на код)
                        </p>
                    </section>

                    <section id="download-traffic" class="content">
                        <h3>Теглене (трафик)</h3>

                        <p>
                            Един очевиден фактор за бавно първоначално зареждане на JavaScript приложение
                            е скоростта на интернет връзката. Това може да се окаже проблем дори и в по-развитите
                            държави.
                        </p>

                        <p>
                            Дали клиентът се е свързал към публичен WiFi, или използва мобилни данни - в крайна сметка,
                            скоростта на интернета му се определя от звеното от веригата с най-ниска скорост или от
                            покритието на използвания от него мобилен оператор - може да е 2G на дадената геолокация.
                        </p>

                        <p class="info box">
                            Бавен интернет резултира в бавно изтегляне на данни за приложението.
                            Приложението трябва да е с възможно най-малко код.
                        </p>

                        <p>
                            За да подобрим скоростта на изтегляне на приложението, прехвърлените байтове
                            информация по мрежата трябва да бъдат минимализирани. Има редица оптимизации
                            за постигане на по-малко количество код. Някои от тях, които ще разгледаме по-късно са:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>Code-Splitting</b>: Доставя се само кодът, от който клиентът има нужда
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Bundling</b>: Обединяване на файлове
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Minification</b>: Минификация
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Uglification</b>: Намаляване броя символи
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Compressing</b>: Компресиране
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Tree-Shaking</b>: Премахване на ненужен код
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Caching</b>: Кеширане
                                </span>
                            </li>
                        </ul>

                        <figure>
                            <img src="images/optimizations.jpg" alt="Optimizations" title="The Cost of JavaScript">
                            <figcaption>
                                <a class="elegant"
                                    href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e"
                                    target="_blank">
                                    Фиг. 1: Най-добри практики за намаляване обема на JavaScript код
                                </a>
                            </figcaption>
                        </figure>
                    </section>

                    <section id="parse-eval" class="content">
                        <h3>Четене и Компилиране на JavaScript код</h3>

                        <p>
                            След като кодът се изтегли от клиентската машина следва той да бъде прочетен и оценен от
                            JavaScript Engine като например <span class="emphasized">V8</span>,
                            <span class="emphasized">SpiderMonkey</span>, <span class="emphasized">JavaScriptCore</span>
                            или <span class="emphasized">Chakra</span>.
                        </p>

                        <p>
                            Тази стъпка от живота на апликацията е много важна, тъй като приложението ще седи в
                            състояние на неизползваемост докато кодът не бъде компилиран.
                        </p>

                        <p class="info box">
                            бързо приложение = (бързо изтегляне) + (бързо четене) + (бързо компилиране)
                        </p>

                        <figure>
                            <img src="images/fast-javascript.jpg" alt="Fast JS" title="Fast JavaScript">
                            <figcaption>
                                <a class="elegant"
                                    href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e"
                                    target="_blank">
                                    Фиг. 2: Компоненти на бързия JavaScript
                                </a>
                            </figcaption>
                        </figure>

                        <p>
                            Интересно е, че байтовете JavaScript код се обработват от клиентската машина
                            по-бавно от еквивалентен обем байтове на други ресурси от приложението. Такива например са
                            изображения и шрифтове. Причината за това, е че тези ресурси не се евалюират и компилират.
                            Снимките, например, само се разчитат и рисуват на екрана.
                        </p>

                        <figure>
                            <img src="images/js-jpeg-bytes.jpg" alt="JS vs JPEG Bytes" title="JS vs JPEG bytes">
                            <figcaption>
                                <a class="elegant"
                                    href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e"
                                    target="_blank">
                                    Фиг. 3: Сравнение времето за обработване на JavaScript и JPEG байтове
                                </a>
                            </figcaption>
                        </figure>
                    </section>

                    <section id="runtime-performance" class="content">
                        <h3>Изпълнение на JavaScript</h3>

                        <p>
                            Колко бързо JavaScript приложението ни ще стане използваемо след изтеглянето на кода не се
                            определя само от четенето и компилирането от JavaScript engine-a. Важен фактор,
                            който не бива да се пренебрегва, е самото изпълнение на кода.
                        </p>

                        <p>
                            Това включва изпълняване на кода, конструиране на <span class="emphasized">DOM</span>
                            дърво, визуализиране на съдържанието на страницата и настройване на клиентски вход.
                            Всичко се случва в основната нишка, което означава, че дълго-изпълняващ се код може да
                            блокира основната нишка на приложението и времето до използваемост да се увеличи.
                        </p>

                        <figure>
                            <img src="images/operations-main-thread.jpg" alt="Operations on main thread"
                                title="Main Thread Work">
                            <figcaption>
                                <a class="elegant"
                                    href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e"
                                    target="_blank">
                                    Фиг. 4: Визуализация на операциите в основната нишка
                                </a>
                            </figcaption>
                        </figure>
                    </section>

                    <section id="cost-of-javascript-other" class="content">
                        <h3>Други</h3>

                        <p>
                            JavaScript приложенията може да се забавят и замръзват периодично поради изпълнението на
                            <span class="emphasized">Garbage Collector</span>. Това се случва, когато JavaScript
                            engine-a си "възвръща" паметта. Този процес може да паузира изпълняването на кода.
                        </p>

                        <p>
                            Дълго изпълняващ се код също може да блокира основната нишка и приложението да "замръзне".
                        </p>

                        <p class="info box">
                            <a class="elegant" title="Animations"
                                href="http://www.javascriptkit.com/javatutors/requestanimationframe.shtml/">
                                <b>[5.5] За по-любопитните:</b>
                            </a> Друг подход, с помощта на който драстично може да се ускори
                            рисуването на страницата и намали използвания ресурс на клиентската машина (CPU, GPU), е
                            чрез
                            употребата на методите <span class="emphasized code">requestAnimationFrame()</span> и
                            <span class="emphasized code">requestIdleCallback()</span>, които са част от
                            <span class="emphasized code">window</span> обекта. Те намират приложение най-вече при
                            добавяне на анимации в JavaScript приложението. Накратко, те позволяват да се изпълни
                            единица код едва тогава, когато машината на потребителя <b>е готова</b> да нарисува кадър.
                        </p>
                    </section>
                </article>

                <article id="prpl-pattern">
                    <section class="introduction">
                        <h2>PRPL шаблон</h2>

                        <p>
                            Идеята на <span class="emphasized">PRPL</span> шаблонът е да се направи така, че
                            приложението да зареди и стане използваемо от клиента по-бързо. Подходът оптимизира
                            приложението чрез <span class="emphasized">code-splitting</span> и
                            <span class="emphasized">caching</span>. Състои се от няколко отделни стъпки:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>Push/Preload:</b> Подготвяне на минимално необходимите ресурси
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Render:</b> Рисуване на началната страница. Още познато като <span
                                        class="emphasized">First Paint</span>.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Pre-Cache:</b> Теглене на останалите ресурси на заден план
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Lazy Load:</b> Теглене на ресурси когато потрябват
                                </span>
                            </li>
                        </ul>

                        <figure>
                            <img src="images/prpl-pattern.jpg" alt="PRPL Pattern" title="PRPL Pattern">
                            <figcaption>
                                <a class="elegant"
                                    href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/javascript-startup-optimization#prpl"
                                    target="_blank">
                                    Фиг. 5: PRPL шаблон
                                </a>
                            </figcaption>
                        </figure>
                    </section>

                    <section id="push-preload" class="content">
                        <h3>Push/Preload: Подготвяне на минимално необходимите ресурси</h3>

                        <p>
                            В тази стъпка се подготвят конкретни ресурси с приоритет
                            (<span class="emphasized">ahead-of-time</span>). Разработчикът е отговорен
                            да е наясно кои ресурси са критични за дадена страница и да ги отбележи като такива чрез
                            използването на <span class="emphasized code">&lt;link&gt;</span> таг в комбинация с
                            <span class="emphasized code">rel="preload"</span> в
                            <span class="emphasized code">&lt;head&gt;</span> на документа. Ще разгледаме
                            <span class="emphasized code">&lt;link rel="preload"&gt;</span> и възможностите, които
                            предоставя.
                        </p>

                        <p>
                            Препоръчително е да се отбележи и какъв е типът на желания ресурс с помощта на
                            <span class="emphasized">as</span> с цел браузърът да може да определи приоритет
                            за ресурса и дали вече съществува в кеша на браузъра. Възможни стойности са
                            <span class="emphasized">script</span>, <span class="emphasized">style</span>,
                            <span class="emphasized">font</span>, <span class="emphasized">image</span> и др.
                            Ресурсите не се изпълняват (<span class="emphasized">script.js</span>) и не се прилагат
                            (<span class="emphasized">style.css</span>) - само се приготвят и влизат в употреба едва
                            когато се наложи. Ето няколко примера:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>script:</b> <span class="emphasized code">&lt;link rel="preload" as="script"
                                        href="critical.js"&gt;</span>
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>font:</b> <span class="emphasized code">&lt;link rel="preload"
                                        href="ComicSans.woff2" as="font" type="font/woff2"&gt;</span>
                                </span>
                            </li>
                        </ul>

                    </section>

                    <section id="first-paint" class="content">
                        <h3>Render: Рисуване на началната страница</h3>

                        <p>
                            Няма единичен най-добър подход за намаляване на <span class="emphasized">Render</span>
                            (<span class="emphasized">First Paint</span>) времето. Някои инструменти за оценка на
                            JavaScript приложения биха предложили да се инжектира най-критичния JavaScript и CSS код в
                            html документа (<span class="emphasized">inlining</span>), а по-малко критичния код и стил
                            да се заредят с <span class="emphasized">defer</span> и
                            <span class="emphasized">async</span>. Чрез<span class="emphasized">inline</span> подхода се
                            намаляват броят на заявки за ресурс клиент &#8660; сървър.
                        </p>

                        <p class="info box">
                            <b>Забележка:</b> Проблемът с inline подходa е, че е много неудобен за поддържане от
                            разработчиците и
                            браузърът не може да го кешира като отделен ресурс.
                        </p>

                        <p>
                            Друг подход е да се рендерира началната страница на сървъра
                            (<span class="emphasized">Server-Side Rendering</span>) и по този начин да се визуализира
                            моментално на машината на клиента.
                        </p>

                        <p class="info box">
                            <b>Забележка:</b> Проблемът със Server-Side Rendering е, че размерът на началната страница
                            може да се увеличи значително и да има забавяне според някоя от метриките,
                            описани в началото на реферата.
                        </p>

                        <section id="async-vs-defer" class="sub-content">
                            <h4>Async vs Defer</h4>

                            <p>
                                На пръв поглед е трудно да се разбере каква е разликата между двата атрибута. Всъщност,
                                те се различават с едно нещо - кога точно да се изпълни скрипта.
                            </p>

                            <ul>
                                <li>
                                    <span>
                                        <b>Async:</b> веднага след изтеглянето. Блокира разчитането на документа от
                                        браузъра.
                                    </span>
                                </li>
                                <li>
                                    <span>
                                        <b>Defer:</b> едва когато документът е разчетен от браузъра. С този атрибут се
                                        гарантира последователността
                                        на изпълнението на скриптовете - както са подредени в кода на страницата.
                                    </span>
                                </li>
                            </ul>

                            <figure>
                                <img src="images/async-vs-defer.jpg" alt="Async vs Defer" title="Async vs Defer">
                                <figcaption>
                                    <a class="elegant"
                                        href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html#legend"
                                        target="_blank">
                                        Фиг. 6: Async vs Defer
                                    </a>
                                </figcaption>
                            </figure>

                            <p class="info box">
                                <b>Забележка:</b> В случай, че нито един от двата атрибута не е зададен: разчитането на
                                страницата се блокира, докато не се изтегли и изпълни скрипта.
                            </p>
                        </section>
                    </section>

                    <section id="pre-cache" class="content">
                        <h3>Pre-Cache: Теглене на останалите ресурси на заден план</h3>

                        <p>
                            Добра практика, вградена в браузърите е кеширане на ресурси. Имат собствено пространство,
                            резервирано за запазване на ресурси локално, които да бъдат използвани директно, вместо
                            да се изтеглят отново от сървъра. Всеки един кеширан ресурс носи със себе си мета
                            информация, предоставена от сървъра чрез <span class="emphasized">HTTP headers</span>, с
                            която
                            уникално бива идентифициран (<span class="emphasized">etag</span>), начина на кеширане
                            (<span class="emphasized">Cache-control</span>), знае се кога "изтича"
                            (<span class="emphasized">Expires</span>) и др.
                        </p>

                        <p>
                            Проблемът с вградената кеш система e, че не винаги можем да разчитаме на нея в случаите, в
                            които не се използват URLs с версия на кеша или <span class="emphasized">Cache
                                Headers</span>
                            са грешно зададени. За да сме сигурни, че клиентът няма остарял кеш и да не блокираме
                            приложението може да се интегрират <span class="emphasized">Service Workers</span>. С
                            тяхна помощ имаме пълен контрол над кеш-пространството на браузъра и можем да проверяваме
                            дали даден ресурс е наистина последна версия. Това може да се случва на заден план.
                        </p>

                        <p class="info box">
                            <b>Забележка:</b> Използването на Cache Headers остава силно препоръчителна практика.
                        </p>
                    </section>

                    <section id="lazy-load" class="content">
                        <h3>Lazy Load: Теглене на ресурси когато потрябват</h3>

                        <p>
                            Последната стъпка от <span class="emphasized">PRPL</span> подхода е да се зареждат ресурси
                            едва тогава, когато клиентът има нужда от тях. За постигането на тази цел, кодът на
                            приложението
                            може да се раздели на малки "части" (файлове / модули).
                        </p>
                    </section>
                </article>

                <article id="optimizations">
                    <section class="introduction">
                        <h2>Намаляване размера на кода</h2>

                        <p>
                            Съществуват различни подходи за намаляването кода на приложение.
                            Като цяло, идеята е да се премахнат всякакви символи, които представляват
                            използвана памет. Това се постига по следните начини:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>Code-Splitting:</b> разделяне на кода на "части". Може да помогне с
                                    интерактивността на приложението.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Bundling:</b> Обединяване на файлове: Обединяване файлове в
                                    <span class="emphasized">bundles</span> с цел намаляване броя на заявките направени
                                    към сървъра за ресурси.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Minification:</b> отстраняване на <span class="emphasized">whitespaces</span>
                                    (space, new lines, tabs, etc).
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Uglification:</b> намаляване броя символи. Свежда имената
                                    (<span class="emphasized">symbols</span>/<span class="emphasized">signatures</span>)
                                    на променливи/функции до такива с минимален брой символи.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Compression:</b> компресиране на файловете от страна на сървъра, които ще бъдат
                                    изпратени на клиента. Съществуват различни стратегии на компресия:
                                    <span class="emphasized">gzip</span>, <span class="emphasized">deflate</span>,
                                    <span class="emphasized">brotli</span>.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Code-Stripping:</b> Премахване на ненужен код. Известно още като
                                    <span class="emphasized">Tree-Shaking</span>.
                                </span>
                            </li>
                        </ul>

                        <p class="info box">
                            <b>Забележка:</b> Повечето инструменти за Minification изпълняват и Uglification.
                        </p>
                    </section>
                </article>

                <article id="javascript-engines">
                    <section class="introduction">
                        <h2>JavaScript Engines</h2>

                        <p>
                            Вече сме запознати с метриките, според които можем да определим скоростта на JavaScript
                            приложение. Знаем, че за да зареди приложение на машината на клиента, то трябва да бъде
                            първо изтеглено, после разчетено, компилирано
                            (<span class="emphasized">Just-In-Time</span> или <span class="emphasized">JIT</span>) и
                            изпълнено. Нека разгледаме как по-точно изтеглената информация бива интерпретирана и
                            изпълнена, евентуални места, които забавят този процес и как да ги подобрим.
                        </p>

                        <p class="info box">
                            <b>Забележка:</b> Изпълняването на JavaScript кода се осъществява от софтуерен компонент,
                            наречен JavaScript
                            Engine.
                        </p>

                        <p>
                            Има редица JavaScript Engines, разработени от различни компании и са предвидени не само за
                            браузъри, а и за runtime softwares като <span class="emphasized">Node.js</span>, новия
                            <span class="emphasized">Deno</span> и др. Някои от тях са:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>V8:</b> разработен от Google. Използва се от Chrome и други Chromium-based
                                    браузъри.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>SpiderMonkey:</b> разработен от Mozilla. Използва се от Firefox и GNOME Shell.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>JavaScriptCore:</b> разработен от Apple. Използва се от Safari и други
                                    WebKit-based
                                    браузъри.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Chakra:</b> разработен от Microsoft. Използва се от Internet Explorer Edge (стара
                                    версия).
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Други:</b> Rhino, KJS, Nashorn, JerryScript
                                </span>
                            </li>
                        </ul>

                        <p class="info box">
                            <b>Забележка:</b> Internet Explorer Edge е преправен като Chromium и използва V8.
                        </p>
                    </section>

                    <section id="javascript-engine-work" class="content">
                        <h3>Как работят JavaScript Engines</h3>

                        <p>
                            Задачата на подобен Engine е да интерпретира, компилира и изпълни даден JavaScript код,
                            тъй като програмният език не може да бъде директно "разбран" от машината. За целта,
                            кодът трябва да бъде сведен до байтове. Това се случва в следните стъпки:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>Parsing:</b> изтеглят се ресурсите като <span class="emphasized">UTF-16</span>
                                    byte stream, подават се към <span class="emphasized">byte stream decoder</span>,
                                    който ги превръща в tokens, които се подават към
                                    <span class="emphasized">Parser</span>.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Abstract Syntax Tree (AST):</b> Parser-ът построява
                                    <span class="emphasized">Абстрактно Синтактично Дърво</span> на кода.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Interpreting:</b> интерпретатор (<span class="emphasized">Ignition</span> за V8)
                                    минава през Синтактичното Дърво и генерира байт код. Той чете кода ред
                                    по ред. При приключване на работата, Синтактичното Дърво бива изтрито (освобождава
                                    се памет).
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Profiling:</b> система следи и търси начини за оптимизиране на кода.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Compiling:</b> компилатор (<span class="emphasized">TurboFan</span> за V8)
                                    транслира кода до език от ниско ниво, който може да бъде разчетен и изпълнен от
                                    машината.
                                </span>
                            </li>
                        </ul>

                        <p>
                            Накратко, JavaScript engine, работи по следния начин:
                        </p>

                        <figure>
                            <img src="images/javascript-engine-v8.gif" alt="V8 Engine" title="V8 JS Engine">
                            <figcaption>
                                <a class="elegant"
                                    href="https://dev.to/edisonpappi/how-javascript-engines-chrome-v8-works-50if"
                                    target="_blank">
                                    Фиг. 7: Работа на JavaScript Engine
                                </a>
                            </figcaption>
                        </figure>
                    </section>
                </article>

                <article id="tools-for-speed-test">
                    <section class="introduction">
                        <h2>Инструменти за оценка на JavaScript приложение</h2>

                        <p>
                            Качеството на JavaScript код много често се прави с помощта на различни видове тестове.
                            Unit, functional, penetration, integration, system, regression, e2e, smoke tests и много
                            други. Хубавото е, че освен за bug-free тестване можем да правим и тестове за качеството на
                            кода преди или по време на изпълнението му. Тази процедура се нарича "Статичен анализ".
                        </p>

                        <p>
                            Инструменти, които правят статичния анализ, разглеждат кода "като човек", с разликата, че са
                            автономни, по-ефикасни, по-бързи и по-консистентни от който и да е човек на земята. За
                            разлика от другите тестове, които биват третирани като черни кутии - подава им се вход и се
                            очаква правилен изход - с помощта на тези тестове можем да разберем дали кодът отговаря на
                            стандарти и най-добри практики. Т.е., дали е написан добре или не.
                        </p>

                        <p>
                            Някои инструменти за статичен анализ:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>LightHouse</b> - инсталирани по подразбиране в браузъра
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>DevTools</b> - инсталирани по подразбиране в браузъра
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    SonarQube
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    JS Inspect
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    JSHint
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    JSCPD
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    ESLint
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    CodePen
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Eslint-plugin-smells
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    FUZZY
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Други
                                </span>
                            </li>
                        </ul>

                        <p class="info box">
                            <b>Забележка:</b> За повече информация за отделните инструменти, моля използвайте
                            линкове
                            <a target="_blank" href="https://deepsource.io/blog/static-analysis-javascript/">[9.1]</a>
                            и <a target="_blank"
                                href="https://www.softwaretestingmagazine.com/tools/open-source-javascript-code-analysis/">[9.2]</a>
                        </p>

                        <p>
                            Информацията, която може да се извлече от подобни инструменти е добре визуализирана и помага
                            на човек да разбере бързо и лесно кое и къде не отговаря на най-добрите практики. Някои от
                            инструментите подсказват и как може да бъде подобрен кода. Примери за какво бива проверявано
                            от инструментите за статичен анализ:
                        </p>

                        <ul>
                            <li>
                                <span class="bold">
                                    Дублиран код
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Излишен код
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Кодова миризма (Code Smell)
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Други
                                </span>
                            </li>
                        </ul>

                        <figure>
                            <img src="images/static-analysis-examples.jpg" alt="static-analysis-examples"
                                title="Примери от статичен анализ">
                            <figcaption>
                                <a class="elegant"
                                    href="https://sudonull.com/post/76091-We-control-the-quality-of-the-code-using-the-SonarQube-platform"
                                    target="_blank">
                                    Фиг. 8: Предложение за подобряване на лош код (SonarQube)
                                </a>
                            </figcaption>
                        </figure>

                        <figure>
                            <img src="images/static-analysis-examples-2.jpg" alt="static-analysis-examples-2"
                                title="Примери от статичен анализ">
                            <figcaption>
                                <a class="elegant"
                                    href="https://www.froztech.com/google-analytics-vs-google-tag-manager/"
                                    target="_blank">
                                    Фиг. 9: Визуализация на дублиран код (SonarQube)
                                </a>
                            </figcaption>
                        </figure>

                        <p class="info box">
                            <b>Забележка:</b> Друг инструмент за оценка на приложението според мрежата е
                            <span class="emphasized">Performance</span> прозорецът в
                            <span class="emphasized">DevTools</span> на браузъра. Там може да се намери
                            голям набор от информация относно целия процес на зареждането на приложението
                            стъпка по стъпка. За повече информация, моля използвайте линка
                            <a target="_blank"
                                href="https://developer.chrome.com/docs/devtools/evaluate-performance/">[9.4]</a>
                        </p>
                    </section>
                </article>

                <article id="google-services">
                    <section class="introduction">
                        <h2>Google услуги</h2>

                        <p>
                            Разработване на приложение не винаги има честта да бъде перфектно оптимизирано за клиента.
                            Има хиляди видове устройства, всяко с уникални разлики спрямо другите. Различават се по
                            операционна система, производителност, защитеност, списъкът е безкраен. Това налага да се
                            разработва едно и също приложение по различни начини, за да бъде то съвместимо с възможно
                            най-много устройства.
                        </p>

                        <p>
                            Поради тази причина, още от самото начало на разработването трябва да се определи целева
                            група клиенти и устройства. Правят се и компромиси за производителността за някои клиенти. Това
                            може да се направи спрямо допитване до клиентите с помощта на въпросник (анкета).
                        </p>

                        <p>
                            Има различни варианти за по-задълбочено опознаване на целевата група клиенти.
                            Собственикът или маркетинговият екип има възможността да разбере за какво трябва да се
                            отделя повече време и внимание, за да се имплементират оптимизации. Такива варианти са
                            например някои от услугите на Google - <span class="emphasized">Google Analytics</span>,
                            <span class="emphasized">Google Tag Manager</span> и др.
                        </p>

                        <figure>
                            <img src="images/google-services.jpg" alt="google-services" title="Услуги на Google">
                            <figcaption>
                                <a class="elegant"
                                    href="https://www.froztech.com/google-analytics-vs-google-tag-manager/"
                                    target="_blank">
                                    Фиг. 10: Услуги на Google за задълбочено запознаване с клиенти
                                </a>
                            </figcaption>
                        </figure>
                    </section>

                    <section id="google-analytics" class="content">
                        <h3>Google Analytics</h3>

                        <p>
                            <span class="emphasized">Google Analytics (GA)</span> е безплатна уеб-услуга на Google.
                            Тя предоставя различни статистики за използването на приложението и инструменти, които
                            спомагат за <span class="emphasized">Search Engine Optimization (SEO)</span>.
                        </p>

                        <p>
                            Интегрирано в приложение, тази услуга събира различна информация идваща непосредствено
                            от клиентите. Примери:
                        </p>

                        <ul>
                            <li>
                                <span>
                                    <b>Live Usage:</b> информация за текущото използване на приложението
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Mестообитание:</b> от коя държава клиентът посещава приложението
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Посещаемост на страници:</b> кои и колко пъти са посещавани конкретни страници
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Реклами:</b> към кои реклами (<span class="emphasized">Google Ads</span>)
                                    клиентът има интерес. Следи се и колко пъти дадена реклама е била отворена през
                                    приложението
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Тип устройство:</b> марка, модел, серия на използваното устройство
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Версия на браузъра:</b> какъв е използваният браузър, версията му,
                                    <span class="emphasized">userAgent</span> и др.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Активност:</b> кога през денонощието клиентите са (най-)активни
                                </span>
                            </li>
                            <li>
                                <span>
                                    <b>Сесия:</b> продължителността на клиентската сесия в приложението или на конкретна
                                    страница
                                </span>
                            </li>
                            <li>
                                <span class="bold">
                                    Други...
                                </span>
                            </li>
                        </ul>

                        <figure>
                            <img src="images/google-analytics-usage.jpg" alt="google-analytics-usage"
                                title="Устройства в Google Analytics">
                            <figcaption>
                                <a class="elegant"
                                    href="https://smartbear.com/blog/use-google-analytics-find-devices-customers-use/"
                                    target="_blank">
                                    Фиг. 11: Информация за текуща активност в приложение
                                </a>
                            </figcaption>
                        </figure>

                        <figure>
                            <img src="images/google-analytics-devices.jpg" alt="google-analytics-devices"
                                title="Устройства в Google Analytics">
                            <figcaption>
                                <a class="elegant"
                                    href="https://smartbear.com/blog/use-google-analytics-find-devices-customers-use/"
                                    target="_blank">
                                    Фиг. 12: Информация за използвани устройства
                                </a>
                            </figcaption>
                        </figure>
                    </section>
                </article>

                <article id="google-tag-manager">
                    <h3>Google Tag Manager</h3>

                    <p>
                        Поведението на клиента може да бъде проследявано чрез интегриране на "тагове" (Google Tags) с
                        помощта на <span class="emphasized">Google Tag Manager (GTM)</span>. Тази услуга има интуитивен
                        интерфейс и прави добавянето и менажирането на тагове лесно. Обещава бързо зареждане за точно и
                        пълно събиране на информация. Също така и лесна свързаност с
                        <span class="emphasized">GA</span>.
                    </p>

                    <figure>
                        <img src="images/google-tag-manager-connection.jpg" alt="google-tag-manager-connection"
                            title="Свързаност с Google Analytics">
                        <figcaption>
                            <a class="elegant"
                                href="https://www.orbitmedia.com/blog/what-is-google-tag-manager-and-why-use-it/"
                                target="_blank">
                                Фиг. 13: Свързаност Приложение -> GTM -> GA
                            </a>
                        </figcaption>
                    </figure>

                    <p>
                        Таговете позволяват на екип от не-разработчици да "инжектират" логика при събития и резултатът
                        да бъде запазен в платформата. Чести събития са:
                    </p>

                    <ul>
                        <li>
                            <span>
                                <b>Отваряне на страница:</b> когато клиент зареди страница
                            </span>
                        </li>
                        <li>
                            <span>
                                <b>Линкове:</b> когато клиент отвори някой линк
                            </span>
                        </li>
                        <li>
                            <span>
                                <b>Форми (Form submittion):</b> когато клиент изпрати форма
                            </span>
                        </li>
                        <li>
                            <span>
                                <b>Скролване (Scroll-Depth):</b> до къде клиент скролва на дадена страница - вертикално
                                или хоризонтално
                            </span>
                        </li>
                        <li>
                            <span>
                                <b>Custom:</b> например когато клиент натисне даден бутон, мине с курсора над елемент и
                                др.
                            </span>
                        </li>
                    </ul>

                    <p>
                        <span class="emphasized">GTM</span> услугата може да бъде и използвана като
                        хранилище на грешки, генерирани локално на машината на клиента. Например, когато код хвърли
                        грешка тя ще бъде изведена в локалната конзола в браузъра на клиента. За да не се загуби като
                        информация за бъдещето й намиране и отстраняване - тя може да бъде запазена в
                        <span class="emphasized">GTM</span>. По този начин, освен екипът разработчици
                        (ако имат достъп до услугата, разбира се) и екипът на не-разработчиците ще има възможността
                        да разбере, че клиент на приложението е получил грешка и каква точно е тя.
                    </p>
                </article>

                <article id="conclusion">
                    <section class="introduction">
                        <h2>Заключение</h2>

                        <p>
                            Писането на JavaScript приложение е много интересен процес, осеян от трудности, правила и
                            различни фактори, от които зависи дали целевата група клиенти ще са доволни и използват
                            приложението или не. Има различни шаблони, атрибути, трикове, които спомагат за по-бързо
                            зареждане на приложението.
                        </p>

                        <p>
                            Трябва да сме запознати с подробностите как работят технологиите на ниско ниво, за да е
                            наистина
                            добре оптимизирано дадено приложение.
                        </p>

                        <p>
                            За щастие има много инструменти, които спомагат за оценка на приложението и дават препоръки
                            как то да се подобри.
                        </p>

                        <p class="info box">
                            <b>Забележка:</b> За допълнително развитие или коментиране на някоя от темите, моля,
                            не се притеснявайте да се свържете с автора :)
                        </p>
                    </section>
                </article>
            </div>
        </div>

        <footer>
            <section id="references">
                <h2>Използвана литература</h2>

                <pre class="external-link box">
                    The Cost of JavaScript
                    [1.1] [<a target="_blank" href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e">https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e</a>]

                    Original Article
                    [1.2] [<a target="_blank" href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/javascript-startup-optimization">https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/javascript-startup-optimization</a>]
                </pre>

                <pre class="external-link box">
                    Minification vs Uglification
                    [2] [<a target="_blank" href="https://stackoverflow.com/a/19694522/13213781">https://stackoverflow.com/a/19694522/13213781</a>]
                </pre>

                <pre class="external-link box">
                    Evaluation of Performance breakdown
                    [3] [<a target="_blank" href="https://twitter.com/kristoferbaxter/status/908144931125858304">https://twitter.com/kristoferbaxter/status/908144931125858304</a>]
                </pre>

                <pre class="external-link box">
                    JavaScript Start-Up Performance
                    [4] [<a target="_blank" href="https://medium.com/reloading/javascript-start-up-performance-69200f43b201">https://medium.com/reloading/javascript-start-up-performance-69200f43b201</a>]
                </pre>

                <pre class="external-link box">
                    PRPL Pattern
                    [5.1] [<a target="_blank" href="https://web.dev/apply-instant-loading-with-prpl/">https://web.dev/apply-instant-loading-with-prpl/</a>]

                    Preload Critical Resources
                    [5.2] [<a target="_blank" href="https://web.dev/preload-critical-assets/">https://web.dev/preload-critical-assets/</a>]

                    Async vs Defer
                    [5.3] [<a target="_blank" href="https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html">https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html</a>]

                    Service Workers Cache Storage
                    [5.4] [<a target="_blank" href="https://web.dev/service-workers-cache-storage/">https://web.dev/service-workers-cache-storage/</a>]

                    requestAnimationFrame()
                    [5.5] [<a target="_blank" href="http://www.javascriptkit.com/javatutors/requestanimationframe.shtml/">http://www.javascriptkit.com/javatutors/requestanimationframe.shtml/</a>]
                </pre>

                <pre class="external-link box">
                    Bundling
                    [6] [<a target="_blank" href="https://medium.com/@samccone/performance-futures-bundling-281543d9a0d5">https://medium.com/@samccone/performance-futures-bundling-281543d9a0d5</a>]
                </pre>

                <pre class="external-link box">
                    Gzip vs Brotli
                    [7] [<a target="_blank" href="https://blog.cloudflare.com/results-experimenting-brotli/">https://blog.cloudflare.com/results-experimenting-brotli/</a>]
                </pre>

                <pre class="external-link box">
                    V8 JavaScript Engine
                    [8.1] [<a target="_blank" href="https://v8.dev/docs">https://v8.dev/docs</a>]
                    [8.2] [<a target="_blank" href="https://medium.com/@_lrlna/garbage-collection-in-v8-an-illustrated-guide-d24a952ee3b8">https://medium.com/@_lrlna/garbage-collection-in-v8-an-illustrated-guide-d24a952ee3b8</a>]
                    [8.3] [<a target="_blank" href="https://dev.to/edisonpappi/how-javascript-engines-chrome-v8-works-50if">https://dev.to/edisonpappi/how-javascript-engines-chrome-v8-works-50if</a>]
                </pre>

                <pre class="external-link box">
                    Static Code Analysis
                    [9.1] [<a target="_blank" href="https://deepsource.io/blog/static-analysis-javascript/">https://deepsource.io/blog/static-analysis-javascript/</a>]
                    [9.2] [<a target="_blank" href="https://www.softwaretestingmagazine.com/tools/open-source-javascript-code-analysis/">https://www.softwaretestingmagazine.com/tools/open-source-javascript-code-analysis/</a>]

                    SonarQube
                    [9.3] [<a target="_blank" href="https://sudonull.com/post/76091-We-control-the-quality-of-the-code-using-the-SonarQube-platform">https://sudonull.com/post/76091-We-control-the-quality-of-the-code-using-the-SonarQube-platform</a>]

                    Performance Tab DevTools
                    [9.4] [<a target="_blank" href="https://developer.chrome.com/docs/devtools/evaluate-performance/">https://developer.chrome.com/docs/devtools/evaluate-performance/</a>]
                </pre>

                <pre class="external-link box">
                    Google Services
                    [10.1] [<a target="_blank" href="https://www.froztech.com/google-analytics-vs-google-tag-manager/">https://www.froztech.com/google-analytics-vs-google-tag-manager/</a>]

                    Google Analytics
                    [10.1] [<a target="_blank" href="https://searchbusinessanalytics.techtarget.com/definition/Google-Analytics">https://searchbusinessanalytics.techtarget.com/definition/Google-Analytics</a>]
                    [10.2] [<a target="_blank" href="https://smartbear.com/blog/use-google-analytics-find-devices-customers-use/">https://smartbear.com/blog/use-google-analytics-find-devices-customers-use/</a>]

                    Google Tag Manager
                    [10.3] [<a target="_blank" href="https://marketingplatform.google.com/about/tag-manager/benefits/">https://marketingplatform.google.com/about/tag-manager/benefits/</a>]
                    [10.4] [<a target="_blank" href="https://www.orbitmedia.com/blog/what-is-google-tag-manager-and-why-use-it/">https://www.orbitmedia.com/blog/what-is-google-tag-manager-and-why-use-it/</a>]
                </pre>
            </section>

            <div id="author-data">
                <address id="personal-data">
                    <strong>
                        <span>Виктор Русев</span>
                    </strong>

                    <a href="https://www.linkedin.com/in/viktorrusev/" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-linkedin" viewBox="0 0 16 16">
                            <path
                                d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z" />
                        </svg>&nbsp;
                        linkedin.com/in/viktorrusev
                    </a>
                    <br />
                    <a href="https://github.com/vikrusev" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                        github.com/vikrusev
                    </a>
                    <br />
                    <a href="mailto:viktor@rusev.dev">viktor@rusev.dev</a>
                    <br />
                    <a href="tel:+359889271000">+359 889 27 1000</a>
                </address>

                <address id="additional-data">
                    <span><b>ФН: 81644</b></span>
                    <span>IV курс, спец. Компютърни Науки, Поток 2, Група 7, 2021-2022 г.</span>
                    <span>курс: Web Технологии</span>
                    <span>лектор: доц. Милен Петров</span>
                    <span>2021 г.</span>
                </address>
            </div>
        </footer>

        <span class="back-to-top">
            <a href="#top"></a>
        </span>
    </div>
</body>

</html>